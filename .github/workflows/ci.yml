name: CI

on:
  pull_request:
    branches: [develop, main]

jobs:
  document_Redpen_CI:
    runs-on: ubuntu-latest
    env:
      Redpen_ver: 1.10.4

    steps:
      - name: リポジトリをチェックアウト
        uses: actions/checkout@v2
        with:
          persist-credentials: false
      - name: aptを最新化
        run: |
          apt update
          apt upgrade -y
      - name: Java、ダウンローダ、解答ソフトをインストール
        run: apt install -y openjdk-11-jre wget tar
      - name: Redpenのインストール
        run: |
          wget https://github.com/redpen-cc/redpen/releases/download/redpen-${Redpen_ver}/redpen-${Redpen_ver}.tar.gz &&
          tar xvf redpen-${Redpen_ver}.tar.gz &&
          cp -av redpen-distribution-${Redpen_ver}/* /usr/local/ &&
          rm -rf redpen-distribution-${Redpen_ver}
      - name: pathに追加
        run: export PATH=$PATH:/usr/local/bin
      - name: Redpenの実行
        run: sh docker/redpen/docker-entrypoint.sh
